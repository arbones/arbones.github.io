<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="JM">
<meta name="dcterms.date" content="2025-12-20">

<title>AI-Enhanced Scientific Writing – ADIPOFAT</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-c1fac2584b48ed01fb6e278e36375074.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">ADIPOFAT</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://arbones.github.io/adipo2/"> 
<span class="menu-text">Research</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/arbones?tab=repositories"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.youtube.com/user/AdipoFat"> <i class="bi bi-youtube" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">AI-Enhanced Scientific Writing</h1>
            <p class="subtitle lead">Transforming Quarto Analyses into Publication-Ready Narratives with Claude code</p>
                                <div class="quarto-categories">
                <div class="quarto-category">Claude</div>
                <div class="quarto-category">AI</div>
                <div class="quarto-category">Writing</div>
                <div class="quarto-category">Quarto</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>JM </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">December 20, 2025</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<section id="what-is-quarto" class="level2">
<h2 class="anchored" data-anchor-id="what-is-quarto">What is Quarto?</h2>
<p>Quarto is an open-source scientific publishing system that enables researchers to weave together code, results, and narrative text into reproducible documents. Think of it as the evolution of R Markdown and Jupyter notebooks, a polyglot platform that works seamlessly with R, Python, Julia, and other languages.</p>
<p>A Quarto project combines:</p>
<ul>
<li><strong>Source files</strong> (<code>.qmd</code> or <code>.ipynb</code>): Plain-text documents containing code chunks, statistical analyses, and markdown text</li>
<li><strong>Configuration</strong> (<code>_quarto.yml</code>): Defines the project structure, navigation, and visual theme</li>
<li><strong>Rendered output</strong> (<code>docs/</code> directory): Auto-generated HTML, PDF, or website versions of your analyses</li>
</ul>
<p>For scientists, Quarto solves a critical problem: maintaining a single source of truth where code and interpretation live together, preventing the drift between analysis and write-up that plagues traditional workflows.</p>
</section>
<section id="the-challenge-from-code-to-coherent-narrative" class="level2">
<h2 class="anchored" data-anchor-id="the-challenge-from-code-to-coherent-narrative">The Challenge: From Code to Coherent Narrative</h2>
<p>While Quarto excels at rendering code and results, transforming computational analysis into publication-ready scientific prose remains cognitively demanding. I normaly must:</p>
<ul>
<li>Synthesize complex operations into clear methodology descriptions</li>
<li>Extract quantitative results from rendered outputs</li>
<li>Maintain consistent scientific voice and style</li>
<li>Ensure logical flow between analysis sections</li>
<li>Balance technical accuracy with accessibility</li>
</ul>
<p>This is where AI integration becomes transformative.</p>
</section>
<section id="the-ai-enhanced-workflow-architecture" class="level2">
<h2 class="anchored" data-anchor-id="the-ai-enhanced-workflow-architecture">The AI-Enhanced Workflow Architecture</h2>
<p><img src="flow.png" class="img-fluid"></p>
<p>I have implemented a Claude-assisted scientific writing system in all my Quarto projects using Positron (IDE enviroment) built on three pillars:</p>
<section id="project-instructions-claude.md" class="level3">
<h3 class="anchored" data-anchor-id="project-instructions-claude.md">1. <strong>Project Instructions (<code>CLAUDE.md</code>)</strong></h3>
<p>The <code>CLAUDE.md</code> file serves as the command center, providing Claude with:</p>
<ul>
<li><strong>System architecture overview</strong>: Explains the Positron IDE environment, Quarto structure, and file organization</li>
<li><strong>Coding standards</strong>: Enforces tidyverse patterns, vectorization over loops, use of native R pipe <code>|&gt;</code>, and mandatory code annotations</li>
<li><strong>Workflow protocols</strong>: Defines how to interpret results, write/edit code, and handle git operations</li>
<li><strong>Quick reference guide</strong>: Maps common requests to specific actions</li>
</ul>
<p>This file essentially “programs” Claude to function as a domain-specific research assistant who understands both the technical environment and scientific goals.</p>
</section>
<section id="context-profiles-.context-directory" class="level3">
<h3 class="anchored" data-anchor-id="context-profiles-.context-directory">2. <strong>Context Profiles (<code>.context/</code> directory)</strong></h3>
<p>Three critical files shape Claude’s behavior:</p>
<section id="quarto-narrative-skillskill.md" class="level4">
<h4 class="anchored" data-anchor-id="quarto-narrative-skillskill.md"><strong><code>quarto-narrative-skill/SKILL.md</code></strong></h4>
<p>This is the heart of the enhancer system; a comprehensive instruction manual for transforming Quarto analyses into scientific narratives. It defines:</p>
<ul>
<li><p><strong>Input requirements</strong>: Reads three files per analysis:</p>
<ol type="1">
<li>The <code>.qmd</code> source (code logic and structure)</li>
<li>The rendered <code>.html</code> (numerical results and outputs)</li>
<li>The <code>index.qmd</code> (experimental context and research questions)</li>
</ol></li>
<li><p><strong>Core workflow</strong>:</p>
<ol type="1">
<li>Parse all input files to extract code operations, results, and context</li>
<li><strong>Maintain exact section hierarchy</strong> from the <code>.qmd</code> structure</li>
<li>For each section: describe code operations → report HTML results → interpret biologically</li>
<li>Apply strict writing style constraints</li>
<li>Synthesize into cohesive narrative prose</li>
</ol></li>
<li><p><strong>HTML parsing strategy</strong>: Extracts content from rendered HTML by identifying text between tags (<code>&lt;p&gt;</code>, <code>&lt;td&gt;</code>, <code>&lt;pre&gt;</code>), ignoring JavaScript/CSS, and pulling numerical values from tables and code outputs</p></li>
<li><p><strong>Special handling</strong>: Covers multiple comparisons, negative results, technical issues, and complex visualizations</p></li>
</ul>
</section>
<section id="writingstyle_osmithies.json" class="level4">
<h4 class="anchored" data-anchor-id="writingstyle_osmithies.json"><strong><code>writingStyle_OSmithies.json</code></strong></h4>
<p>A structured specification of scientific voice inspired by Nobel laureate Oliver Smithies. Key constraints:</p>
<ul>
<li><strong>Voice</strong>: Active, first-person agency (“We performed” not “was performed”)</li>
<li><strong>Tone</strong>: Decisive, objective, authoritative—avoid hedging</li>
<li><strong>Sentence structure</strong>: Under 25 words, one idea per sentence, linear flow</li>
<li><strong>Data reporting</strong>: Specific values, explicit statistical significance</li>
<li><strong>Flow pattern</strong>: Context → Action → Result → Meaning</li>
</ul>
<p>Example transformation:</p>
<pre><code>❌ "Analysis was performed using DESeq2"
✅ "We performed analysis using DESeq2"

❌ "Many genes were significant"
✅ "We detected 347 significant genes"</code></pre>
</section>
<section id="git_workflow.md" class="level4">
<h4 class="anchored" data-anchor-id="git_workflow.md"><strong><code>git_workflow.md</code></strong></h4>
<p>Enforces version control standards:</p>
<ul>
<li>Commit format: Title line + bullet points explaining specific changes</li>
<li>Distinguishes between detailed explanations (for analysis code) and simple messages (for documentation)</li>
<li>Explicitly excludes AI attribution messages</li>
</ul>
<p><strong>IMPORTANT</strong>: These files live inside the Quarto project</p>
</section>
</section>
<section id="the-invocation-pattern" class="level3">
<h3 class="anchored" data-anchor-id="the-invocation-pattern">3. <strong>The Invocation Pattern</strong></h3>
<p>When I need to document an analysis, I fire up Claude code in a terminal window and use the next prompt to trigger the workflow:</p>
<pre><code>"Write the analysis for xxxxxx.qmd" </code></pre>
<p>Claude then invokes quarto-narrative-skill:</p>
<ol type="1">
<li>Reads the source <code>.qmd</code> file (understanding methodology)</li>
<li>Reads the rendered <code>.html</code> file (extracting results)</li>
<li>Reads <code>index.qmd</code> (gathering experimental context)</li>
<li>Applies the Oliver Smithies writing style</li>
<li>Generates publication-ready prose that:
<ul>
<li>Maintains the exact section structure from the <code>.qmd</code></li>
<li>Describes what each code chunk does and why</li>
<li>Reports specific numerical results from the HTML</li>
<li>Provides biological interpretation</li>
<li>Uses active voice, concise sentences, and precise terminology</li>
</ul></li>
</ol>
</section>
</section>
<section id="example-output-pattern" class="level2">
<h2 class="anchored" data-anchor-id="example-output-pattern">Example Output Pattern</h2>
<p>Given a <code>.qmd</code> section:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Differential Expression Analysis</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>dds <span class="ot">&lt;-</span> <span class="fu">DESeq</span>(dds)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">results</span>(dds, <span class="at">contrast=</span><span class="fu">c</span>(<span class="st">"genotype"</span>, <span class="st">"APOE2"</span>, <span class="st">"WT"</span>))</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>res_sig <span class="ot">&lt;-</span> <span class="fu">subset</span>(res, padj <span class="sc">&lt;</span> <span class="fl">0.05</span> <span class="sc">&amp;</span> <span class="fu">abs</span>(log2FoldChange) <span class="sc">&gt;</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>And HTML showing:</p>
<pre><code>347 genes with padj &lt; 0.05 and |log2FC| &gt; 1
Upregulated: 198 genes
Downregulated: 149 genes</code></pre>
<p>Claude generates: &gt; “We performed differential expression analysis using DESeq2 to compare APOE2 and wild-type mice. We identified 347 genes with adjusted p-values below 0.05 and absolute log2 fold changes exceeding 1. Of these, 198 genes showed increased expression in APOE2 mice, while 149 showed decreased expression.”</p>
</section>
<section id="why-this-approach-works" class="level2">
<h2 class="anchored" data-anchor-id="why-this-approach-works">Why This Approach Works</h2>
<p>This system succeeds because it:</p>
<ol type="1">
<li><strong>Separates concerns</strong>: Code lives in <code>.qmd</code>, results in <code>.html</code>, style rules in <code>CLAUDE.md</code> and <code>.context/</code>. Style rules can be reused in other projects.</li>
<li><strong>Enforces consistency</strong>: The writing style JSON ensures every narrative follows the same rigorous standard</li>
<li><strong>Preserves scientific accuracy</strong>: By reading both source code and rendered output, Claude reports exact values and methods</li>
<li><strong>Maintains structure</strong>: The skill explicitly preserves the <code>.qmd</code> section hierarchy, preventing AI “creativity” from reorganizing logical flow</li>
<li><strong>Is reproducible</strong>: The entire workflow is version-controlled and can be audited</li>
</ol>
</section>
<section id="key-innovations" class="level2">
<h2 class="anchored" data-anchor-id="key-innovations">Key Innovations</h2>
<ul>
<li><strong>HTML-as-database</strong>: Treating rendered HTML as a structured data source for result extraction</li>
<li><strong>Style-as-code</strong>: Formalizing scientific voice into a machine-readable specification</li>
<li><strong>Context injection</strong>: Using <code>.context/</code> files to provide persistent behavioral constraints</li>
<li><strong>Skill-based invocation</strong>: Creating specialized “modes” for Claude through detailed skill definitions</li>
</ul>
</section>
<section id="practical-benefits" class="level2">
<h2 class="anchored" data-anchor-id="practical-benefits">Practical Benefits</h2>
<p>For researchers, this system:</p>
<ul>
<li>Reduces writing time from hours to minutes</li>
<li>Ensures consistent voice across multi-year projects</li>
<li>Catches methodology/results mismatches (if code doesn’t match description, it’s obvious)</li>
<li>Enables rapid iteration (change analysis → re-render → regenerate narrative)</li>
<li>Creates an audit trail (git history shows when code changed vs.&nbsp;when prose changed)</li>
</ul>
</section>
<section id="files-that-make-it-work" class="level2">
<h2 class="anchored" data-anchor-id="files-that-make-it-work">Files That Make It Work</h2>
<p>Essential components:</p>
<ul>
<li><strong><code>CLAUDE.md</code></strong>: System instructions and quick reference</li>
<li><strong><code>.context/quarto-narrative-skill/SKILL.md</code></strong>: Narrative generation protocol</li>
<li><strong><code>.context/writingStyle_OSmithies.json</code></strong>: Voice specification</li>
<li><strong><code>.context/git_workflow.md</code></strong>: Version control standards</li>
<li><strong><code>_quarto.yml</code></strong>: Project configuration</li>
</ul>
<p>Together, these files transform Claude from a general-purpose AI into a specialized scientific writing assistant that understands computational biology, R/Python code, statistical analysis, and publication standards.</p>
</section>
<section id="the-future-of-ai-assisted-science" class="level2">
<h2 class="anchored" data-anchor-id="the-future-of-ai-assisted-science">The Future of AI-Assisted Science</h2>
<blockquote class="blockquote">
<p>This method demonstrates that AI’s value in research isn’t just running analyses, it’s in maintaining the connective tissue between computation and communication. By codifying scientific writing standards and creating structured workflows, we can leverage AI to handle the mechanical aspects of prose generation while researchers focus on interpretation and discovery.</p>
</blockquote>
<blockquote class="blockquote">
<p>The <strong>system is transparent, auditable, and version-controlled</strong>, essential properties for scientific reproducibility. It doesn’t replace scientific thinking; it amplifies it by removing friction between “I analyzed this” and “I can clearly explain what I did.”</p>
</blockquote>
<hr>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>© 2025 JM Arbones-Mainar</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>